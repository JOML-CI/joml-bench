# How to run

With JAVA_HOME and PATH pointing to a Panama vectorIntrinsics build, run:

```
./mvnw package && java --add-modules jdk.incubator.vector -jar target/bench.jar
```

Without having a local Panama vectorIntrinsics build, run:
```
./ci.sh
```
This will shallow-clone the [GitHub mirror of the Panama vectorIntrinsics branch](https://github.com/openjdk/panama-vector/tree/vectorIntrinsics), build the JDK and execute the benchmarks using it. Make sure your system fulfills the [OpenJDK build requirements](https://github.com/openjdk/panama-vector/blob/vectorIntrinsics/doc/building.md). See the section "Clean Ubuntu Setup" below for a clean Ubuntu setup.
The space requirements for such a cloned and fully built JDK is ~5.6GB, which will reside inside of the panama-vector directory.
In addition, the hsdis utility library is built and installed into the JDK's lib directory.

## Clean Ubuntu Setup (tested on Ubuntu 20.04)

```
sudo apt install -y openjdk-14-jdk-headless \
                    libasound2-dev \
                    libfontconfig1-dev \
                    libcups2-dev \
                    libx11-dev \
                    libxext-dev \
                    libxrender-dev \
                    libxrandr-dev \
                    libxtst-dev \
                    libxt-dev \
                    git \
                    zip \
                    unzip \
                    automake \
                    autoconf \
                    build-essential
```

## Seeing the disassembly

In order to see the x86 code generated by the JIT compiler for all methods, run:
```
java --add-modules jdk.incubator.vector -XX:+UnlockDiagnosticVMOptions -XX:CompileCommand=print,*Matrix*.* -cp target/bench.jar bench.C2
```
The x86 code is then printed to stdout. This requires the hsdis utility library available in the $JAVA_HOME/lib directory, as is provided by `./ci.sh`.

# Results

## Intel Xeon E-2176M
```
Benchmark                Mode  Cnt   Score   Error  Units
Bench.mul128LoopArr      avgt    5  32.460 ± 0.374  ns/op
Bench.mul128LoopBB       avgt    5  41.958 ± 0.500  ns/op
Bench.mul128UnrolledArr  avgt    5  29.327 ± 0.328  ns/op
Bench.mul128UnrolledBB   avgt    5  37.489 ± 0.718  ns/op
Bench.mul256Arr          avgt    5  26.298 ± 0.079  ns/op
Bench.mul256BB           avgt    5  29.945 ± 0.063  ns/op
Bench.mulJniAVX          avgt    5  13.552 ± 0.031  ns/op
Bench.mulJniSSE          avgt    5  14.050 ± 0.089  ns/op
Bench.mulScalar          avgt    5  18.729 ± 0.075  ns/op
Bench.mulScalarFma       avgt    5  14.567 ± 0.254  ns/op
Bench.noopJni            avgt    5  10.811 ± 0.037  ns/op
```

## Intel Xeon Platinum 8124M
```
Benchmark                Mode  Cnt   Score   Error  Units
Bench.mul128LoopArr      avgt    5  33.849 ± 1.017  ns/op
Bench.mul128LoopBB       avgt    5  39.956 ± 0.686  ns/op
Bench.mul128UnrolledArr  avgt    5  32.195 ± 1.176  ns/op
Bench.mul128UnrolledBB   avgt    5  40.582 ± 0.736  ns/op
Bench.mul256Arr          avgt    5  35.740 ± 0.614  ns/op
Bench.mul256BB           avgt    5  33.070 ± 0.042  ns/op
Bench.mulJniAVX          avgt    5  14.457 ± 0.004  ns/op
Bench.mulJniSSE          avgt    5  14.460 ± 0.025  ns/op
Bench.mulScalar          avgt    5  22.179 ± 0.104  ns/op
Bench.mulScalarFma       avgt    5  16.444 ± 0.024  ns/op
Bench.noopJni            avgt    5  12.394 ± 0.044  ns/op
```
